version: '3.8'

# =============================================================================
# MongoDB Backup Manager - Docker Compose Configuration
# =============================================================================
# This configuration sets up:
#   - Main application (backup manager)
#   - MongoDB instance (for testing/development)
#   - FTP server (for testing remote backup storage)
#
# For production, remove or comment out the mongo and ftp services
# and configure the environment variables to point to your existing services.
# =============================================================================

services:
  # ---------------------------------------------------------------------------
  # Main Application - MongoDB Backup Manager
  # ---------------------------------------------------------------------------
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mongodb-backup-manager
    ports:
      - "5552:5552"
      - "5551:5551"
    environment:
      - PORT=5552
      - HOST=0.0.0.0
      - NODE_ENV=production
      # Authentication (CHANGE IN PRODUCTION!)
      - ADMIN_USER=admin
      - ADMIN_PASS=admin
      - JWT_SECRET=change_this_jwt_secret_to_something_random_and_secure
      # Backup settings
      - KEEP_LOCAL_BACKUPS=true
      - KEEP_LAST_N_BACKUPS=30
      - RETENTION_DAYS=30
      - BACKUP_CRON=0 2 * * *
      # Security
      - SETTINGS_ENCRYPTION_KEY=change_this_to_a_very_long_random_key_minimum_32_characters_long
    volumes:
      - backup-data:/app/data
      - backup-logs:/app/logs

    restart: unless-stopped
    networks:
      - backup-network


# -----------------------------------------------------------------------------
# Volumes
# -----------------------------------------------------------------------------
volumes:
  backup-data:
    name: mongodb-backup-data
  backup-logs:
    name: mongodb-backup-logs


# -----------------------------------------------------------------------------
# Networks
# -----------------------------------------------------------------------------
networks:
  backup-network:
    name: mongodb-backup-network
    driver: bridge
